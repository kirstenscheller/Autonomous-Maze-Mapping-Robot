<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>ECE 3400 Team 2 Website</title>

  <!-- Bootstrap Core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom Fonts -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="css/stylish-portfolio.min.css" rel="stylesheet">

</head>

<body id="page-top">

  <!-- Navigation -->
  <a class="menu-toggle rounded" href="#">
    <i class="fas fa-bars"></i>
  </a>
  <nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
      <li class="sidebar-brand">
        <a class="js-scroll-trigger" href="#">Team 2</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger" href="index.html">Home</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger" href="index.html#Team">Team Members</a>
      </li>
 	<li class="sidebar-nav-item">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> <span class="nav-label">Labs</span><span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a style="color: #1D809F" href="lab1.html#Lab1">Lab 1</a></li>
                        <li><a style="color: #1D809F" href="lab2.html#Lab2">Lab 2</a></li>
                        <li><a style="color: #1D809F" href="lab3.html#Lab3">Lab 3</a></li>
                         <li><a style="color: #1D809F" href="lab4_milestone4.html#Milestone4">Lab 4</a></li>
                    </ul>
                </li>
 	<li class="sidebar-nav-item">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> <span class="nav-label">Milestones</span><span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a style="color: #1D809F" href="milestones.html#Milestone1">Milestone 1</a></li>
                        <li><a style="color: #1D809F" href="milestone2.html#Milestone2">Milestone 2</a></li>
                        <li><a style="color: #1D809F" href="milestone3.html#Milestone3">Milestone 3</a></li>
                        <li><a style="color: #1D809F" href="lab4_milestone4.html#Milestone4">Milestones 4</a></li>
                    </ul>
                </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger" href="TEAM CONTRACT.pdf">Team Contract</a>
      </li>
    </ul>
  </nav>

  <!-- Header -->
  <header class="masthead d-flex">
    <div class="container text-center my-auto">
      <h1 class=class="mb-1" style="color: white; text-shadow: 2px 2px 5px black">Labs</h1>
      <h3 class=class="mb-1" style="color: white; text-shadow: 2px 2px 5px black">
        <em> What We Have Worked on in Labs </em>
      </h3>
      <a class="btn btn-primary btn-xl js-scroll-trigger" href="#Labs">Start</a>
    </div>
    <div class="overlay"></div>
  </header>
	
  <!-- Labs -->
  <section class="content-section bg-primary text-white text-center" id="Labs">
    <div class="container">
      <div class="content-section-heading">
        <h3 class="text-secondary mb-0">Labs</h3>
        <h2 class="mb-5">What We Worked On</h2>
      </div>
      <div class="row">
        <div class="col-lg-3 col-md-6 mb-5 mb-lg-0">
          <span class="service-icon rounded-circle mx-auto mb-3">
   	<a href="lab1.html#Lab1"><i class="icon-screen-smartphone"></i></a>
          </span>
          <h4><a href="lab1.html#Lab1" style="color: #FFFFFF">
	<strong  >Lab1</strong>
		  </h4></a>

          <p class="text-faded mb-0">Microcontrollers</p>

        </div>
        <div class="col-lg-3 col-md-6 mb-5 mb-lg-0">
          <span class="service-icon rounded-circle mx-auto mb-3">
          <a href="lab2.html#Lab2"><i class="icon-pencil"></i></a>
          </span>
          <h4><a href="lab2.html#Lab2" style="color: #FFFFFF">
            <strong  >Lab2</strong>
          </h4></a>
          <p class="text-faded mb-0"> FFT and Schmitt Trigger</p>
        </div>
        <div class="col-lg-3 col-md-6 mb-5 mb-md-0">
          <span class="service-icon rounded-circle mx-auto mb-3">
          <a href="lab3.html#Lab3"><i class="icon-like"></i></a>
          </span>
          <h4><a href="lab3.html#Lab3" style="color: #FFFFFF">
		  <strong>Lab 3</strong>
          </h4></a>
          <p class="text-faded mb-0">FPGA Video Controller</p>
        </div>
        <div class="col-lg-3 col-md-6">
          <span class="service-icon rounded-circle mx-auto mb-3">
            <a href="lab4_milestone4.html#Milestone4"><i class="icon-mustache"></i></a>
          </span>
          <h4><a href="lab4_milestone4.html#Milestone4" style="color: #FFFFFF">
		  <strong>Lab 4</strong>
          </h4></a>
          <p class="text-faded mb-0">Radio Communication and Full Robotic Integration</p>
        </div>
      </div>

    </div>
  </section>
	
 <!--Lab3-->
  <section class="content-section bg-light" id="Lab3">
    <div class="container">
      <div class="row text-center">
        <div class="col-lg-10 mx-auto">
          <h2>Lab 3 FPGA Video Controller</h2>
          <div class="row">
          <div class="col-lg-3"> 
   
           </div>
          </div>
         
        </div>
      </div>

  <br/>
      <br/>
      
	    <div class="row">
        <div class="col-lg-10 mx-auto">
		<p style = "text-indent: 50px;">In this lab, we are creating a video controller with an FPGA, controlled by an Arduino Uno. We will design and code a memory system for pixels, and also set up the communication between the FPGA and the Arduino. </p>
		<ul>Materials Used:
			<li>1 Arduino Uno</li>
			<li>1 USB A/B cable</li>
			<li>1 DE0-Nano Development Board</li>
			<li>1 Pre-built DAC circuit board</li>
			<li>Various resistors</li>
			<li>1 VGA cable</li>
			
		</ul>
		<!-- part 1-->
		<h3>Part I: FPGA Video Controller</h3>
		<p>1. One of the difficult parts of this lab is to get a good understanding of how each part is related to each other and how they work as a whole. The picture shows at a high level how each sub-module is connected and how the signals flow. </p>
		</br>
		    
		<img src="Pictures/FPGA.png"/>
	</br>
 	</br>
	<p>2. In our Verilog code, there are one top module, the DE0_NANO, and three sub-modules, IMAGE_PROCESSOR, M9K_RAM, and VGA_DRIVER. Basically, the image processor will take in data (the x and y position of the robot in the maze and wall information from the sensors). It will then assign colors for each pixel and map it to the M9K RAM. Then the VGA driver will read the memory and then output the display on the monitor. The VGA driver output will be 8 bits, three bits for red, three bits for green, and two bits for blue. Since the VGA cable is an analog cable that only has one wire for red, one wire for blue, and one wire for blue. Therefore, we need to use the pre-made DAC to convert the digital signals to analog signals so that the pixel can be properly displayed on the monitor. </p>
	    </br>
	  
	    <p>3. We started by downloading the template from Fall 2018 and following the instruction to create the PLL since we need a clock to run our device. The FPGA can generate a 50 MHz Clock called CLOCK_50. We can divide this in logic, however, this approach is susceptible to clock skew. Therefore,  it is much more pragmatic to use a Phase-locked loop (PLL). This will ensure that the clocks are treated in the FPGA as actual clock lines and that they remain locked in phase, preventing skew. </p>
	    </br>
	    <p>4. After we set up the PLL, we uploaded the example Verilog code onto the FPGA. It is supposed to show a blue screen with a black square on the top left corner since blue is the default value and we are not writing anything to the M9K RAM yet. When we uploaded onto the board, we got what we expected.  </P>
    </br>
	<p>5. After we made sure the base code worked, we tried to change the color of the square on the screen. To do that, we created an always block in the DE0_NANO module. In the always block, we iterate through every pixel in the 270*270 matrix and assign it to red. Here is the Verilog code for the always block. </p>
	<code > 
		<pre style="color: #b32789">
	always @ (posedge CLK_50) begin
		pixel_data_RGB332 <= RED;
		x_addr <= x_addr +15'd1;
		W_EN <= 1'b1;
		if (x_addr > 'SCREEN_WIDTH) begin
			y_addr <= y_addr + 15'd1;
			x_addr <= 15'd0;
			W_EN <= 1'b1;
		end
	end
		</pre>
		</code>	
<p>6. We then connected one of the Arduino output to GPIO_1_D[25] of the FPGA to control the square on the screen. When the output is HIGH, the square will be red; when the output is LOW, the square will be green. The video below shows the color of the screen changing based on the input from Arduino. In the video, the Arduino signal will be high for 5 seconds and then go low for 5 seconds. </p>
	
	    <video width ="360" height ="640" controls>

			    <source src = "Videos/square FPGA.mp4" type = "video/mp4"

				    Your Browser does not support the video tag.
				    </video> 
		     </div>
          </div>
	    <br/>
	    <br/>
	  <div class="row">
        <div class="col-lg-10 mx-auto">
	   <p>7. All of our implementations were done in the image processor. In the image processor, using the data from the Arduino about the x,y coordinates of the location of the Arduino and the wall information, we assign colors to specific pixels and send the information to the M9K RAM. We have one always block that only starts when we get an input from the Arduino. This always block assigns different colors to each pixel based on the wall information. We do not care about the location coordinate of the Arduino at this point, as we are only assigning colors to the pixels in that one 30*30 pixel grid. This information is then used in the next always block which writes pixel color assignment information to the M9K RAM constantly as long as the clock is operational. This will keep updating the color assignment for each pixel to the ram. Here, the address where this information gets stored in the ram is calculated from the location coordinates of the Arduino and the coordinates within the tile, so when new location and wall data is being inputted from the Arduino, image processor should immediately start writing the data in the new addresses while the first always block updates color assignment for each pixel, so the data for tiles in other grids don’t get overwritten. Below is our logic written in Verilog.</p>
	            	<code > 
		<pre style="color: #b32789">
	always @ (arduino_in) begin
		//assign color to pixels on the 30*30 tile for one coordinate on the map
		if (left wall is there) color in the left pixels
		if (front wall is there) color in the top pixels
		if (right wall is there) color in the right pixels
	end
	
	always @ (posedge clock) begin
	//write the color assignments to M9K ram making sure to account for the offset created by the Arduino location coordinates
	end
		</pre>
		</code>	
		  <p>8. We encountered a problem where our code would display three squares on the screen even though we only made one. With the help from the TA, we realized that we needed to change the bit widths for some of our variables. First of all, we needed to change the pixel_data_RGB332 to 4 bits. The reason was that there is limited space in the memory and we need to truncate the data so that the data will get send without being messed up. We also changed the w_addr and r_addr to 18 bits in the M9K RAM module.  The video below shows our code working by displaying a 30*5 red rectangle on the top left corner of the screen. The red rectangle is produced by the image processor and got mapped to the M9K RAM. We used a digital signal from the Arduino to control the on/off of the rectangle. 
 </p>
	
	     <video width ="360" height ="640" controls>
			    <source src = "Videos/rectangle.mp4" type = "video/mp4"
				    Your Browser does not support the video tag.
				    </video>	    
           </div>
          </div>
	    <br/>
	    <br/>
        
	    <!--part2-->    
	    
    <div class="row">
        <div class="col-lg-10 mx-auto">
		<h3>Part II: Communication between FPGA and Arduino</h3>
		</br>
	<p>1. There are different kinds of communication protocols, SPI, parallel bus, etc. We decided to use parallel bus communication since it is easier to implement than SPI. Also, we don’t have pin restrictions since we are using the base station Arduino and the base station only needs to communicate with the other Arduino and FPGA. Parallel communication is a method of conveying multiple binary digits (bits) simultaneously. The picture illustrates how parallel communication works. 
</P>
	    	    <img src="Pictures/Parallel Bus.JPG"/>
	    </br>
	  </br>
	    <p>2. To set up the parallel bus communication, we set up 11 digitals pins as the output from the Arduino. There are 11 bits because we need four bits each for x and y locations of the robots, and we also need three additional bits to send the information of the three wall sensors. Then we set up the GPIO_1_D pins on the FPGA as the input. For testing purposes, we only wired up one data line. And we programmed the Arduino to output HIGH for 5 seconds and LOW for 5 seconds to control the FPGA. If HIGH, the screen will show a 30*5 rectangle on the top left screen; if LOW, then the whole visible screen will just become green. Please refer to the video above for a working parallel communication between the Arduino and FPGA.</P>
</br>
	<p>3. One thing that needs attention is that the DE0_NANO operates at 3.3V, and the Arduino operates at 5V. Therefore, we need to make a voltage divider when we connect the digital output from the Arduino to the FPGA GPIO pins. We used 5.6KΩ and 10KΩ resistors to make the voltage divider. So, the output of the voltage divider is:  </P>
	<p>Vout = Vin*(R2/(R1+R2)) = 5V *( 10K/15.6K) = 3.205V </p>
	<p>4. One last thing for connecting the Arduino and the FPGA is that we also need a common ground. The picture below shows the connection between the Arduino and the FPGA.</p>
		<img width = "800" height = "600" src="Pictures/FPGA_Arduino connection.jpg"/>

	  <br/>
      <br/>

	
    </div>
  </section>

  <!-- Callout -->
  <section class="callout">
    <div class="container text-center">
      <h2 class="mx-auto mb-5">Welcome to
        <em>our</em>
        website!</h2>
      <a class="btn btn-primary btn-xl" href="#">Github Link</a>
    </div>
  </section>



  <!-- Call to Action -->
  <section class="content-section bg-primary text-white">
    <div class="container text-center">
      <h2 class="mb-4">The buttons below are impossible to resist...</h2>
      <a href="#" class="btn btn-xl btn-light mr-4">Click Me!</a>
      <a href="#" class="btn btn-xl btn-dark">Look at Me!</a>
    </div>
  </section>

 


  <!-- Footer -->
  <footer class="footer text-center">
    <div class="container">
      <ul class="list-inline mb-5">
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white mr-3" href="#">
            <i class="icon-social-facebook"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white mr-3" href="#">
            <i class="icon-social-twitter"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white" href="#">
            <i class="icon-social-github"></i>
          </a>
        </li>
      </ul>
      <p class="text-muted small mb-0">Copyright &copy; Start Bootstrap: Stylish Portfolio Theme</p>
    </div>
  </footer>

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded js-scroll-trigger" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/stylish-portfolio.min.js"></script>

</body>

</html>

